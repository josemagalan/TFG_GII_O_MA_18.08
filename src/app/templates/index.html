{% extends "base.html" %}

{% block app_content %}
	
	<script type="text/javascript">
		function muestraJuego(jgo){
			capa = document.getElementById("capaJuego");
			capa.style.display='block';
			window.scroll(0,70);
			
			var idPunt = 'punt'+jgo[15];
			var idMedia = 'media'+jgo[15];
			var idnStarsMedia = 'nStarsMedia'+jgo[15];
			var idnUsersPlay = 'nUsersPlay'+jgo[15];
			var id5Star = '5Stars'+jgo[15];
			var id4Star = '4Stars'+jgo[15];
			var id3Star = '3Stars'+jgo[15];
			var id2Star = '2Stars'+jgo[15];
			var id1Star = '1Stars'+jgo[15];
			
			document.getElementById("identJuego").innerHTML = jgo[15];
			document.getElementById("imagenJuego").src="http://archive.org/services/img/"+jgo[5];
			document.getElementById("nombreJuego").innerHTML = jgo[0];
			document.getElementById("fabricJuego").innerHTML = 'by '+jgo[1];
			document.getElementById("linkJuego").src="http://archive.org/details/"+jgo[5];
			document.getElementById("eye").innerHTML = jgo[2];
			document.getElementById("star").innerHTML = jgo[3];
			document.getElementById("comment").innerHTML = jgo[4];
			document.getElementById("mediaJuego").innerHTML = document.getElementById(idMedia).innerHTML;
			document.getElementById("nStarsMediaJuego").src = document.getElementById(idnStarsMedia).src;
			document.getElementById("nUsersPlayJuego").innerHTML = document.getElementById(idnUsersPlay).innerHTML;
			document.getElementById("5StarsJuego").innerHTML = document.getElementById(id5Star).innerHTML;
			document.getElementById("4StarsJuego").innerHTML = document.getElementById(id4Star).innerHTML;
			document.getElementById("3StarsJuego").innerHTML = document.getElementById(id3Star).innerHTML;
			document.getElementById("2StarsJuego").innerHTML = document.getElementById(id2Star).innerHTML;
			document.getElementById("1StarsJuego").innerHTML = document.getElementById(id1Star).innerHTML;
			document.getElementById("puntJuego").innerHTML = document.getElementById(idPunt).innerHTML;
			document.getElementById("clik0").setAttribute("onClick", "cambiaPuntuacion(" + jgo[15] + "," + jgo[16] + ", '--');");
			document.getElementById("clik1").setAttribute("onClick", "cambiaPuntuacion(" + jgo[15] + "," + jgo[16] + ", '1')");
			document.getElementById("clik2").setAttribute("onClick", "cambiaPuntuacion(" + jgo[15] + "," + jgo[16] + ", '2')");
			document.getElementById("clik3").setAttribute("onClick", "cambiaPuntuacion(" + jgo[15] + "," + jgo[16] + ", '3')");
			document.getElementById("clik4").setAttribute("onClick", "cambiaPuntuacion(" + jgo[15] + "," + jgo[16] + ", '4')");
			document.getElementById("clik5").setAttribute("onClick", "cambiaPuntuacion(" + jgo[15] + "," + jgo[16] + ", '5')");	
		}
	</script>
	
	<script>
		function escondeJuego(){
			capa = document.getElementById("capaJuego");
			capa.style.display='none';
		}
	</script>
	
	<script type="text/javascript">
		function cambiaPuntuacion(idJuego, idUser, valor){
			var idPunt = 'punt'+idJuego;
			var idMedia = 'media'+idJuego;
			var idnStarsMedia = 'nStarsMedia'+idJuego;
			var idnUsersPlay = 'nUsersPlay'+idJuego;
			var id5Star = '5Stars'+idJuego;
			var id4Star = '4Stars'+idJuego;
			var id3Star = '3Stars'+idJuego;
			var id2Star = '2Stars'+idJuego;
			var id1Star = '1Stars'+idJuego;
			
			var puntAnterior = document.getElementById(idPunt).innerHTML;
			puntAnterior =  puntAnterior.replace(/ /g,"");
			if (puntAnterior != '--') { parseInt(puntAnterior); }

			var mediaAnt = parseFloat(document.getElementById(idMedia).innerHTML);
			var nUsersPlayAnt = parseInt(document.getElementById(idnUsersPlay).innerHTML);
			var cinStarAnt = parseInt(document.getElementById(id5Star).innerHTML);
			var cuaStarAnt = parseInt(document.getElementById(id4Star).innerHTML);
			var treStarAnt = parseInt(document.getElementById(id3Star).innerHTML);
			var dosStarAnt = parseInt(document.getElementById(id2Star).innerHTML);
			var unaStarAnt = parseInt(document.getElementById(id1Star).innerHTML);
			var media;
			var unaStar = unaStarAnt;
			var dosStar = dosStarAnt;
			var treStar = treStarAnt;
			var cuaStar = cuaStarAnt;
			var cinStar = cinStarAnt;
			
			if (puntAnterior != valor){
				// Si puntacion Anterior == 0 -> hay un jugador más
				// Si no -> quitamos una puntación a la anterior
				if (puntAnterior == '--') { nUsersPlayAnt = nUsersPlayAnt + 1; }
					
				// Si valor == 0 -> hay un jugador menos y quita la estrella
				if (valor == '--') { 
					nUsersPlayAnt = nUsersPlayAnt - 1;
					if (puntAnterior == 1) { unaStar = unaStarAnt - 1; }
					else if (puntAnterior == 2) { dosStar = dosStarAnt - 1; }
					else if (puntAnterior == 3) { treStar = treStarAnt - 1; }
					else if (puntAnterior == 4) { cuaStar = cuaStarAnt - 1; }
					else if (puntAnterior == 5) { cinStar = cinStarAnt - 1; }								
				}
				else if (valor == 1) { 
					unaStar = unaStarAnt + 1;
					if (puntAnterior == 2) { dosStar = dosStarAnt - 1; }
					else if (puntAnterior == 3) { treStar = treStarAnt - 1; }
					else if (puntAnterior == 4) { cuaStar = cuaStarAnt - 1; }
					else if (puntAnterior == 5) { cinStar = cinStarAnt - 1; }								
				}
				else if (valor == 2) { 
					dosStar = dosStarAnt + 1;
					if (puntAnterior == 1) { unaStar = unaStarAnt - 1; }
					else if (puntAnterior == 3) { treStar = treStarAnt - 1; }
					else if (puntAnterior == 4) { cuaStar = cuaStarAnt - 1; }
					else if (puntAnterior == 5) { cinStar = cinStarAnt - 1; }									
				}
				else if (valor == 3) { 
					treStar = treStarAnt + 1; 
					if (puntAnterior == 1) { unaStar = unaStarAnt - 1; }
					else if (puntAnterior == 2) { dosStar = dosStarAnt - 1; }
					else if (puntAnterior == 4) { cuaStar = cuaStarAnt - 1; }
					else if (puntAnterior == 5) { cinStar = cinStarAnt - 1; }									
				}
				else if (valor == 4) { 
					cuaStar = cuaStarAnt + 1; 
					if (puntAnterior == 1) { unaStar = unaStarAnt - 1; }
					else if (puntAnterior == 2) { dosStar = dosStarAnt - 1; }
					else if (puntAnterior == 3) { treStar = treStarAnt - 1; }
					else if (puntAnterior == 5) { cinStar = cinStarAnt - 1; }									
				}
				else if (valor == 5) { 
					cinStar = cinStarAnt + 1; 
					if (puntAnterior == 1) { unaStar = unaStarAnt - 1; }
					else if (puntAnterior == 2) { dosStar = dosStarAnt - 1; }
					else if (puntAnterior == 3) { treStar = treStarAnt - 1; }
					else if (puntAnterior == 4) { cuaStar = cuaStarAnt - 1; }
					}
				
				media = ((cinStar*5 + cuaStar*4 + treStar*3 + dosStar*2 + unaStar)/nUsersPlayAnt);
				media = media.toFixed(1);
				
				if (media > -0.5 && media <= 0.5) {document.getElementById(idnStarsMedia).src = "static/simbolos/star_cero.png";}
				else if (media < 1) {document.getElementById(idnStarsMedia).src = "static/simbolos/star_cero_med.png";}
				else if (media < 1.5) {document.getElementById(idnStarsMedia).src = "static/simbolos/star_uno.png";}
				else if (media < 2) {document.getElementById(idnStarsMedia).src = "static/simbolos/star_uno_med.png";}
				else if (media < 2.5) {document.getElementById(idnStarsMedia).src = "static/simbolos/star_dos.png";}
				else if (media < 3) {document.getElementById(idnStarsMedia).src = "static/simbolos/star_dos_med.png";}
				else if (media < 3.5) {document.getElementById(idnStarsMedia).src = "static/simbolos/star_tres.png";}
				else if (media < 4) {document.getElementById(idnStarsMedia).src = "static/simbolos/star_tres_med.png";}
				else if (media < 4.5) {document.getElementById(idnStarsMedia).src = "static/simbolos/star_cuatro.png";}
				else if (media < 5) {document.getElementById(idnStarsMedia).src = "static/simbolos/star_cuatro_med.png";}
				else {document.getElementById(idnStarsMedia).src = "static/simbolos/star_cinco.png";}						
				
				document.getElementById(idnUsersPlay).innerHTML = nUsersPlayAnt;
				document.getElementById(idPunt).innerHTML = valor;
				document.getElementById(idMedia).innerHTML = media;
				document.getElementById(id5Star).innerHTML = cinStar;
				document.getElementById(id4Star).innerHTML = cuaStar;
				document.getElementById(id3Star).innerHTML = treStar;
				document.getElementById(id2Star).innerHTML = dosStar;
				document.getElementById(id1Star).innerHTML = unaStar;

				var jgoDesplegado = document.getElementById("identJuego").innerHTML;
				if ( idJuego == jgoDesplegado ) {
					document.getElementById("mediaJuego").innerHTML = media;
					document.getElementById("nUsersPlayJuego").innerHTML = nUsersPlayAnt;
					document.getElementById("5StarsJuego").innerHTML = cinStar;
					document.getElementById("4StarsJuego").innerHTML = cuaStar;
					document.getElementById("3StarsJuego").innerHTML = treStar;
					document.getElementById("2StarsJuego").innerHTML = dosStar;
					document.getElementById("1StarsJuego").innerHTML = unaStar;
					document.getElementById("puntJuego").innerHTML = valor;
					
					if (media > -0.5 && media <= 0.5) {document.getElementById("nStarsMediaJuego").src = "static/simbolos/star_cero.png";}
					else if (media < 1) {document.getElementById("nStarsMediaJuego").src = "static/simbolos/star_cero_med.png";}
					else if (media < 1.5) {document.getElementById("nStarsMediaJuego").src = "static/simbolos/star_uno.png";}
					else if (media < 2) {document.getElementById("nStarsMediaJuego").src = "static/simbolos/star_uno_med.png";}
					else if (media < 2.5) {document.getElementById("nStarsMediaJuego").src = "static/simbolos/star_dos.png";}
					else if (media < 3) {document.getElementById("nStarsMediaJuego").src = "static/simbolos/star_dos_med.png";}
					else if (media < 3.5) {document.getElementById("nStarsMediaJuego").src = "static/simbolos/star_tres.png";}
					else if (media < 4) {document.getElementById("nStarsMediaJuego").src = "static/simbolos/star_tres_med.png";}
					else if (media < 4.5) {document.getElementById("nStarsMediaJuego").src = "static/simbolos/star_cuatro.png";}
					else if (media < 5) {document.getElementById("nStarsMediaJuego").src = "static/simbolos/star_cuatro_med.png";}
					else {document.getElementById("nStarsMediaJuego").src =  "static/simbolos/star_cinco.png";}	
				}
				
				
				// Actualiza tablas R, Y
			}
			
		}
	</script>
	
	
	<table>
        <tr style = "vertical-align:bottom">
            <td style="width: 10%"><img src="{{url_for('static', filename="avatares/" + current_user.avatar + ".png")}}" width="70" height="70" alt="user avatar"/></td>
            <td style="width: 25%"> <h2>Hi! {{ current_user.username }}</h2> </td>
			<td style="width: 65%; text-align:right; color:gray"> <h3><i> {{ texto_cab }} </i></h3> </td>
        </tr>
    </table>
	
	<div id="capaJuego" style="display:none">
		<hr/>
		<iframe height="500px" width="100%" name="iframe_a" title="zona de juego" style = "background-color: #f8f8f8; box-shadow: 3px 3px 15px gray">
		</iframe>
		
		<div style="margin-top:20px; margin-bottom:40px; width:100%; height:150px">
			<div>
				<img id="imagenJuego" style="width:100px; height:150px; float:left" src="" alt="imagen juego" />	
			</div>
			
			<div style="width:100px; height:150px; float:left; margin-left:20px" >
				<div style="height:65%">
					<div id="nombreJuego" style="color:#2980B9"></div>
					<div id="fabricJuego" style="font-size:10px; color:gray"></div>
				</div>
				<div style = "font-size:9px; text-align:center; height:35%; color:gray">
					<div style="margin-top:10px; margin-bottom:6px; text-align:left">
						<a id="linkJuego" href="" target="_blank" style="font-size:9px;"> juega en su web </a>
					</div>
					<div style = "width: 25%; float:left">
						<img src="{{url_for('static', filename="simbolos/disk.png")}}" width="18" height="18" alt="software"/>
					</div>
					<div style = "width: 25%; float:left">
						<img src="{{url_for('static', filename="simbolos/eye.png")}}" width="12" height="12" alt="eyes"/>
						<p id="eye"><p>
					</div>
					<div style = "width: 25%; float:left">
						<img src="{{url_for('static', filename="simbolos/star.png")}}" width="10" height="10" alt="stars"/>
						<p id="star"><p>
					</div>
					<div style = "width: 25%; float:right">
						<img src="{{url_for('static', filename="simbolos/comment.png")}}" width="12" height="10" alt="comments"/>
						<p id="comment"><p>
					</div>					
				</div>
			</div>
			
			<div style = "font-size:9px; width:200px; height:150px; float:left; margin-left:30px; padding-left:20px; border-left:1px solid #D8D8D8">
				<div style="height:60%">
					<div style = "vertical-align:top; width:50%; float:left; padding-right:7px; text-align:center">
						<div id="mediaJuego" style= "vertical-align:top; height:42px; font-size:35px; color:#e67e22; text-shadow: -1px 0 gray, 0 1px gray,
	1px 0 gray, 0 -1px gray"></div>
						<img id="nStarsMediaJuego" src="" width="100%" alt="stars media"/>
						<div style = "margin-top:10px; vertical-align:top">
							<img style = "vertical-align:top; width:9px; height:9px" src="{{url_for('static', filename="simbolos/user.png")}}" alt="total users"/> 
							<span id="nUsersPlayJuego"></span>
						</div>
					</div>
					
					<div style = "width:50%; float:right; padding-left:20px; padding-top:9px">
						<img style = "vertical-align:top" src="{{url_for('static', filename="simbolos/star_cinco.png")}}" width="80%" alt="cinco estrellas"/> 
						<span id="5StarsJuego"></span>							
						<img style = "vertical-align:top" src="{{url_for('static', filename="simbolos/star_cuatro.png")}}" width="80%" alt="cuatro estrellas"/> 
						<span id="4StarsJuego"></span>
						<img style = "vertical-align:top" src="{{url_for('static', filename="simbolos/star_tres.png")}}" width="80%" alt="tres estrellas"/> 
						<span id="3StarsJuego"></span>
						<img style = "vertical-align:top" src="{{url_for('static', filename="simbolos/star_dos.png")}}" width="80%" alt="dos estrellas"/> 
						<span id="2StarsJuego"></span>
						<img style = "vertical-align:top" src="{{url_for('static', filename="simbolos/star_uno.png")}}" width="80%" alt="una estrella"/> 
						<span id="1StarsJuego"></span>
					</div>
				</div>
				
				<div style = "font-size:11px; height:25%">
					<div style = "width:70%; padding-top:11px; padding-left:9px; float:left; color:#2980B9">
						tu valoración
					</div>					
					<div id="puntJuego" style = "width:30%; float:right; padding-right:7px; text-align:right; font-size:25px; color:#e67e22"></div>

				</div>	

				<div style="height:15%; text-align:right">
					<div style="float:left; width:16%">
						<button id="clik0" class="btn btn-default btn-xs">
							-
						</button>
					</div>
					<div style="float:left; width:16%">
						<button id="clik1" class="btn btn-default btn-xs">
							1
						</button>
					</div>
					<div style="float:left; width:16%">						
						<button id="clik2" class="btn btn-default btn-xs">
							2
						</button>
					</div>
					<div style="float:left; width:16%">
						<button id="clik3" class="btn btn-default btn-xs">
							3
						</button>
					</div>
					<div style="float:left; width:16%">
						<button id="clik4" class="btn btn-default btn-xs">
							4
						</button>
					</div>
					<div style="float:left; width:16%">
						<button id="clik5" class="btn btn-default btn-xs">
							5
						</button>
					</div>
				</div>				
			</div>

			<div style="float:right; vertical-align:top; margin-top:10px">
				<button type="button" class="btn btn-default" aria-label="Left Align" onClick="escondeJuego()">
					<span class="glyphicon glyphicon-chevron-up" aria-hidden="true"></span> Cerrar Juego
				</button>
				<div id="identJuego" style="color:white"></div>
			</div>
			
		</div>
	</div>
	
	{% include 'include_juegos_lista.html' %}

	
{% endblock %}
